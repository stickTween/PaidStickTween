-- Steal a Brainrot Teleport Stick Script for Delta Executor
-- Автор: Grok (образовательный пример)
-- Версия: 7.4 (сентябрь 2025) -- Текст "Teleport..." теперь почти на весь экран с TextScaled
-- Функции: Кастомный GUI, круг "stick" для toggle, Ragdoll Fly TP (bypass flag), Noclip, God Mode, Anti-Cheat Bypass, Tween Overlay

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

-- Переменные
local savedPosition = nil
local gui = nil
local teleportButton = nil
local isDragging = false
local dragStart = nil
local startPos = nil
local isGuiVisible = false
local stickButton = nil
local noclipConnection = nil
local originalCanCollide = {}
local isNoclipEnabled = false -- Новая переменная для состояния Noclip
local overlayGui = nil -- Новый overlay для телепортации

-- Noclip функция (временно отключает коллизию)
local function toggleNoclip(enabled)
    if enabled then
        noclipConnection = RunService.Stepped:Connect(function()
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") and part.CanCollide then
                    originalCanCollide[part] = part.CanCollide
                    part.CanCollide = false
                end
            end
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        for part, collide in pairs(originalCanCollide) do
            if part and part.Parent then
                part.CanCollide = collide
            end
        end
        originalCanCollide = {}
    end
end

-- Создание overlay для телепортации (чёрный экран с текстом)
local function createOverlay()
    overlayGui = Instance.new("ScreenGui")
    overlayGui.Name = "TeleportOverlay"
    overlayGui.ResetOnSpawn = false
    overlayGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    overlayGui.DisplayOrder = -1 -- Низкий ZIndex, чтобы быть под CoreGui (чат, топбар)
    overlayGui.Parent = game:GetService("CoreGui")

    -- Чёрный фон (полностью покрывает экран)
    local blackFrame = Instance.new("Frame")
    blackFrame.Size = UDim2.new(1, 0, 1, 0)
    blackFrame.Position = UDim2.new(0, 0, 0, 0)
    blackFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    blackFrame.BackgroundTransparency = 0 -- Полностью чёрный
    blackFrame.BorderSizePixel = 0
    blackFrame.ZIndex = 1 -- Низкий, под CoreGui
    blackFrame.Parent = overlayGui

    local blackCorner = Instance.new("UICorner")
    blackCorner.CornerRadius = UDim.new(0, 0)
    blackCorner.Parent = blackFrame

    -- Текст "Teleport..." (теперь почти на весь экран)
    local teleportText = Instance.new("TextLabel")
    teleportText.Size = UDim2.new(0.9, 0, 0.5, 0) -- 90% ширины, 50% высоты для почти полного экрана
    teleportText.Position = UDim2.new(0.05, 0, 0.25, 0) -- Центрировано (5% отступ слева, 25% сверху)
    teleportText.BackgroundTransparency = 1
    teleportText.Text = "Teleport..."
    teleportText.TextColor3 = Color3.fromRGB(255, 255, 255)
    teleportText.TextSize = 400 -- Максимальный размер для TextScaled (но игнорируется)
    teleportText.TextScaled = true -- Автоматическое масштабирование текста до размера контейнера
    teleportText.Font = Enum.Font.SourceSansBold
    teleportText.ZIndex = 2 -- Над чёрным фоном
    teleportText.Parent = overlayGui

    -- Анимация текста (пульсация для эффекта)
    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
    local textTween = TweenService:Create(teleportText, tweenInfo, {TextTransparency = 0.5})
    textTween:Play()

    -- Изначально скрыто
    overlayGui.Enabled = false
end

-- Функция показа/скрытия overlay
local function showOverlay(show)
    if overlayGui then
        overlayGui.Enabled = show
    end
end

-- Создание кастомного GUI
local function createGUI()
    gui = Instance.new("ScreenGui")
    gui.Name = "TeleportStickGui"
    gui.ResetOnSpawn = false
    gui.Parent = game:GetService("CoreGui")

    -- Основной фрейм (увеличен для новой кнопки)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 200, 0, 200) -- Увеличено с 150 до 200
    frame.Position = UDim2.new(0.5, -100, 0.5, -100)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Visible = isGuiVisible
    frame.Parent = gui

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = frame

    -- Заголовок
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Position = UDim2.new(0, 0, 0, 5)
    title.BackgroundTransparency = 1
    title.Text = "teleport stick"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 20
    title.Font = Enum.Font.SourceSansBold
    title.Parent = frame

    -- Save Position
    local saveButton = Instance.new("TextButton")
    saveButton.Size = UDim2.new(0.8, 0, 0, 40)
    saveButton.Position = UDim2.new(0.1, 0, 0, 45)
    saveButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    saveButton.Text = "Save Position"
    saveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    saveButton.TextSize = 18
    saveButton.Font = Enum.Font.SourceSans
    local saveCorner = Instance.new("UICorner")
    saveCorner.CornerRadius = UDim.new(0, 8)
    saveCorner.Parent = saveButton
    saveButton.Parent = frame

    saveButton.MouseButton1Click:Connect(function()
        savedPosition = humanoidRootPart.CFrame
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Teleport Stick",
            Text = "Position saved! Teleport button added.",
            Duration = 3
        })
        if not teleportButton then
            teleportButton = Instance.new("TextButton")
            teleportButton.Size = UDim2.new(0.8, 0, 0, 40)
            teleportButton.Position = UDim2.new(0.1, 0, 0, 95)
            teleportButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
            teleportButton.Text = "Teleport (Ragdoll Fly)"
            teleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            teleportButton.TextSize = 18
            teleportButton.Font = Enum.Font.SourceSans
            local tpCorner = Instance.new("UICorner")
            tpCorner.CornerRadius = UDim.new(0, 8)
            tpCorner.Parent = teleportButton
            teleportButton.Parent = frame

            teleportButton.MouseButton1Click:Connect(function()
                if savedPosition then
                    -- Показать overlay перед началом телепортации
                    showOverlay(true)
                    
                    -- Безопасная позиция (Y >= 5)
                    local targetPos = savedPosition.Position
                    if targetPos.Y < 5 then
                        targetPos = Vector3.new(targetPos.X, 5, targetPos.Z)
                    end
                    -- Ragdoll Fly TP
                    local distance = (humanoidRootPart.Position - targetPos).Magnitude
                    local flyTime = math.max(1, distance / 1000) -- 1-3 сек, скорость ~25 studs/sec
                    humanoid.PlatformStand = true -- Ragdoll эффект
                    toggleNoclip(true) -- Noclip для прохождения стен
                    local bodyVelocity = Instance.new("BodyVelocity")
                    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
                    bodyVelocity.Velocity = (targetPos - humanoidRootPart.Position).Unit * 1000 -- Направленная скорость
                    bodyVelocity.Parent = humanoidRootPart
                    -- Лёгкий спин для "необычности"
                    local angularVelocity = Instance.new("BodyAngularVelocity")
                    angularVelocity.MaxTorque = Vector3.new(200, 800, 200)
                    angularVelocity.AngularVelocity = Vector3.new(250, 100, 650) -- Медленный поворот
                    angularVelocity.Parent = humanoidRootPart
                    -- Ждём прибытия и скрываем overlay
                    wait(flyTime)
                    bodyVelocity:Destroy()
                    angularVelocity:Destroy()
                    humanoidRootPart.CFrame = CFrame.new(targetPos) -- Финальный snap (минимальный, после полёта)
                    humanoid.PlatformStand = false
                    toggleNoclip(false)
                    showOverlay(false) -- Скрыть overlay после полёта
                    
                    -- Задержка 2 сек (без overlay)
                    humanoid.WalkSpeed = 0
                    wait(2)
                    humanoid.WalkSpeed = 30
                    game:GetService("StarterGui"):SetCore("SendNotification", {
                        Title = "Teleport Stick",
                        Text = "Ragdoll flew to position! (Bypass active)",
                        Duration = 2
                    })
                else
                    game:GetService("StarterGui"):SetCore("SendNotification", {
                        Title = "Teleport Stick",
                        Text = "Save a position first!",
                        Duration = 3
                    })
                end
            end)
        end
    end)

    -- Toggle Noclip кнопка (новая)
    local noclipButton = Instance.new("TextButton")
    noclipButton.Size = UDim2.new(0.8, 0, 0, 40)
    noclipButton.Position = UDim2.new(0.1, 0, 0, 145) -- Позиция ниже Teleport
    noclipButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    noclipButton.Text = isNoclipEnabled and "Disable Noclip" or "Enable Noclip"
    noclipButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    noclipButton.TextSize = 18
    noclipButton.Font = Enum.Font.SourceSans
    local noclipCorner = Instance.new("UICorner")
    noclipCorner.CornerRadius = UDim.new(0, 8)
    noclipCorner.Parent = noclipButton
    noclipButton.Parent = frame

    noclipButton.MouseButton1Click:Connect(function()
        isNoclipEnabled = not isNoclipEnabled
        toggleNoclip(isNoclipEnabled)
        noclipButton.Text = isNoclipEnabled and "Disable Noclip" or "Enable Noclip"
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Teleport Stick",
            Text = isNoclipEnabled and "Noclip enabled!" or "Noclip disabled!",
            Duration = 2
        })
    end)

    -- Перетаскивание
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)

    frame.InputChanged:Connect(function(input)
        if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
        end
    end)

    -- Круг "stick"
    stickButton = Instance.new("TextButton")
    stickButton.Size = UDim2.new(0, 60, 0, 60)
    stickButton.Position = UDim2.new(1, -80, 0.5, -30)
    stickButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    stickButton.Text = "stick"
    stickButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    stickButton.TextSize = 14
    stickButton.Font = Enum.Font.SourceSansBold
    local stickCorner = Instance.new("UICorner")
    stickCorner.CornerRadius = UDim.new(0.5, 0)
    stickCorner.Parent = stickButton
    stickButton.Parent = gui

    stickButton.MouseButton1Click:Connect(function()
        isGuiVisible = not isGuiVisible
        frame.Visible = isGuiVisible
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Teleport Stick",
            Text = isGuiVisible and "GUI opened!" or "GUI closed!",
            Duration = 2
        })
    end)

    return gui
end

-- God Mode
local function setupGodMode()
    humanoid.HealthChanged:Connect(function(health)
        if health < humanoid.MaxHealth then
            humanoid.Health = humanoid.MaxHealth
        end
    end)

    local mt = getrawmetatable(game)
    local oldIndex = mt.__index
    setreadonly(mt, false)
    mt.__index = newcclosure(function(self, key)
        if self == humanoid and key == "TakeDamage" then
            return function() end
        end
        return oldIndex(self, key)
    end)
    setreadonly(mt, true)

    spawn(function()
        while true do
            wait(0.1)
            if humanoidRootPart.Position.Y < -50 then
                humanoidRootPart.CFrame = CFrame.new(humanoidRootPart.Position.X, 5, humanoidRootPart.Position.Z)
                humanoid.Health = humanoid.MaxHealth
            end
        end
    end)

    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Teleport Stick",
        Text = "God Mode enabled!",
        Duration = 5
    })
end

-- Anti-Cheat Bypass
local function setupBypass()
    local mt = getrawmetatable(game)
    local oldNamecall = mt.__namecall
    setreadonly(mt, false)
    mt.__namecall = newcclosure(function(self, ...)
        local method = getnamecallmethod()
        if self == player and method == "Kick" then
            return
        end
        return oldNamecall(self, ...)
    end)
    setreadonly(mt, true)

    local antiCheatEvents = {"AntiCheatCheck", "TeleportMonitor", "KickPlayer", "MarkPlayer"} -- Добавлен MarkPlayer
    for _, eventName in pairs(antiCheatEvents) do
        local remote = ReplicatedStorage:FindFirstChild(eventName)
        if remote then
            local connections = getconnections(remote.OnClientEvent)
            for _, connection in pairs(connections) do
                connection:Disable()
            end
        end
    end

    local oldGetConnections = getconnections
    getconnections = function(signal)
        if typeof(signal) == "RBXScriptSignal" and signal:IsA("RemoteEvent") then
            return {}
        end
        return oldGetConnections(signal)
    end

    spawn(function()
        while true do
            wait(math.random(45, 75))
            local oldCFrame = humanoidRootPart.CFrame
            humanoidRootPart.CFrame = oldCFrame * CFrame.new(math.random(-1, 1), 0, math.random(-1, 1))
            wait(0.1)
            humanoidRootPart.CFrame = oldCFrame
        end
    end)

    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Teleport Stick",
        Text = "Anti-Cheat Bypass enabled!",
        Duration = 5
    })
end

-- Инициализация
createOverlay() -- Создать overlay
createGUI()
setupBypass()
setupGodMode()

-- Обработка respawn
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    humanoid = character:WaitForChild("Humanoid")
    wait(1)
    setupBypass()
    setupGodMode()
    toggleNoclip(false) -- Сброс noclip
    isNoclipEnabled = false -- Сброс состояния
end)

-- F1 toggle
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.F1 then
        isGuiVisible = not isGuiVisible
        gui:FindFirstChild("Frame").Visible = isGuiVisible
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Teleport Stick",
            Text = isGuiVisible and "GUI opened!" or "GUI closed!",
            Duration = 2
        })
    end
end)

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Teleport Stick",
    Text = "Loaded! Ragdoll Fly TP with black overlay. Click 'stick' or F1. God Mode active. Toggle Noclip added. Risk of ban remains.",
    Duration = 5
})
